# =============================================================================
# orbis.conf — Configuration principale du projet Orbis Alternis
# =============================================================================
# Diffuseur RTMPS/BTFS pour Raspberry Pi 4 (ARM64)
# Projet : diffuseur-rtmps-btfs-ARM64
# Éditer ce fichier avant tout lancement de diffusion.
# NE PAS committer les clés de flux (DLIVE_CLE_FLUX / KICK_CLE_FLUX) sur git.
# =============================================================================

# --- BTFS -------------------------------------------------------------------
BTFS_PASSERELLE="http://127.0.0.1:8080/btfs"
BTFS_REPO="/home/thalyn/.btfs"
BTFS_CHAINE_ID="1029"          # testnet=1029 | mainnet=199
BTFS_DAEMON_CMD="btfs daemon --chain-id ${BTFS_CHAINE_ID}"
BTFS_DELAI_DEMARRAGE=10        # Secondes d'attente après lancement du démon BTFS

# --- Chemins du projet -------------------------------------------------------
REPERTOIRE_PROJET="/home/thalyn/OrbisAlternis"
REPERTOIRE_LDL="${REPERTOIRE_PROJET}/ldl"
REPERTOIRE_IMG="${REPERTOIRE_PROJET}/img"
REPERTOIRE_JOURNAUX="${REPERTOIRE_PROJET}/journaux"
REPERTOIRE_CONF="${REPERTOIRE_PROJET}/conf"
REPERTOIRE_SCRIPTS="${REPERTOIRE_PROJET}/scripts"

# --- Outils système ----------------------------------------------------------
FFMPEG="/usr/bin/ffmpeg"
FFPROBE="/usr/bin/ffprobe"
CURL="/usr/bin/curl"
STUNNEL="/usr/bin/stunnel4"

# --- Encodage vidéo ----------------------------------------------------------
# Encodeur : libx264 (logiciel, compatible) | h264_v4l2m2m (matériel Pi4, plus rapide)
ENCODEUR_VIDEO="libx264"
PRESET_ENCODAGE="veryfast"     # ultrafast/superfast/veryfast/faster/fast/medium
PROFIL_H264="main"             # baseline/main/high
NIVEAU_H264="4.0"
DEBIT_IMAGES=30                # IPS (images par seconde)
GOP=60                         # Intervalle images-clés = 2 × DEBIT_IMAGES

# --- Résolution maximale -----------------------------------------------------
# Tous les formats (16/9, 16/10, 21/9...) sont adaptés et encadrés de bandes noires
LARGEUR_MAX=1920
HAUTEUR_MAX=1080

# --- Plateforme DLive (RTMP) -------------------------------------------------
DLIVE_ACTIF=true
DLIVE_SERVEUR="rtmp://stream.dlive.tv/live"
DLIVE_CLE_FLUX=""              # ← Renseigner votre clé de flux DLive ici
DLIVE_BITRATE_VIDEO=4500       # kbps — Max recommandé DLive
DLIVE_BITRATE_AUDIO=160        # kbps

# --- Plateforme Kick (RTMPS via Stunnel) ------------------------------------
KICK_ACTIF=true
KICK_SERVEUR_REEL="fa723fc1b171.global-contribute.live-video.net"
KICK_PORT_REEL=443
KICK_CHEMIN="/app"
KICK_CLE_FLUX=""               # ← Renseigner votre clé de flux Kick ici
KICK_BITRATE_VIDEO=6000        # kbps — Max recommandé Kick
KICK_BITRATE_AUDIO=160         # kbps
# Stunnel : nginx-rtmp pousse vers ce port local, Stunnel chiffre vers Kick
STUNNEL_PORT_LOCAL=11935

# --- Nginx relais RTMP local -------------------------------------------------
NGINX_PORT_RTMP=1935
NGINX_CHEMIN_APPLICATION="diffusion"

# --- Comportement de la liste de lecture -------------------------------------
BOUCLE=true                    # Répéter la liste indéfiniment
MELANGE=false                  # Mélanger aléatoirement l'ordre
DELAI_ENTRE_VIDEOS=5           # Secondes de pause entre chaque vidéo
TENTATIVES_RECONNEXION=3       # Tentatives en cas d'erreur de diffusion
DELAI_RECONNEXION=10           # Secondes avant nouvelle tentative

# --- Filigrane (logo "à la volée") -------------------------------------------
FILIGRANE_ACTIF=false
FILIGRANE_IMAGE="${REPERTOIRE_IMG}/logo.png"
# Position : coin haut-gauche=10:10 | bas-droite=main_w-overlay_w-10:main_h-overlay_h-10
FILIGRANE_POSITION="10:10"
FILIGRANE_OPACITE=0.85

# --- Surcouche webcam (pour "watch party") -----------------------------------
WEBCAM_ACTIF=false
WEBCAM_PERIPHERIQUE="/dev/video0"
WEBCAM_LARGEUR=320
WEBCAM_HAUTEUR=180
WEBCAM_DEBIT_IMAGES=30
# Position de la vignette webcam (bas-droite par défaut)
WEBCAM_POSITION="main_w-overlay_w-10:main_h-overlay_h-10"

# --- Journalisation ----------------------------------------------------------
NIVEAU_JOURNAL="INFO"          # DEBUG | INFO | AVERT | ERREUR
CONSERVATION_JOURNAUX=14       # Jours de conservation des fichiers journaux
